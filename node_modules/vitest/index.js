const tests = [];

function describe(_name, fn) {
  fn();
}

function it(name, fn) {
  tests.push({ name, fn });
}

function expect(value) {
  return {
    toBe: (expected) => {
      if (value !== expected) {
        throw new Error(`Expected ${value} to be ${expected}`);
      }
    },
    toBeTruthy: () => {
      if (!value) {
        throw new Error('Expected value to be truthy');
      }
    }
  };
}

async function run() {
  let failed = 0;
  for (const test of tests) {
    try {
      await test.fn();
      console.log(`✓ ${test.name}`);
    } catch (err) {
      failed += 1;
      console.error(`✗ ${test.name}: ${err.message}`);
    }
  }
  if (failed > 0) {
    process.exitCode = 1;
  }
}

module.exports = { describe, it, expect, run };
